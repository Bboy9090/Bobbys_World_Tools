/**
 * Exploit Selector
 * 
 * Dropdown menu for jailbreak method selection.
 */

import React, { useState } from 'react';
import { ChevronDown, Zap } from 'lucide-react';
import { cn } from '@/lib/utils';

interface ExploitSelectorProps {
  selectedDevice: any | null;
  onSelectExploit: (exploit: string) => void;
}

const EXPLOITS = [
  { id: 'checkra1n', name: 'Checkra1n', description: 'A5-A11 devices', compatible: ['dfu', 'recovery'] },
  { id: 'palera1n', name: 'Palera1n', description: 'A8-A11 devices', compatible: ['dfu', 'recovery'] },
  { id: 'unc0ver', name: 'Unc0ver', description: 'A12+ devices', compatible: ['normal'] },
  { id: 'custom', name: 'Custom Script', description: 'User-defined exploit', compatible: ['dfu', 'recovery', 'normal'] },
];

export function ExploitSelector({ selectedDevice, onSelectExploit }: ExploitSelectorProps) {
  const [selectedExploit, setSelectedExploit] = useState<string | null>(null);
  const [isOpen, setIsOpen] = useState(false);

  const handleSelect = (exploit: string) => {
    setSelectedExploit(exploit);
    setIsOpen(false);
    if (selectedDevice) {
      onSelectExploit(exploit);
    }
  };

  const compatibleExploits = selectedDevice
    ? EXPLOITS.filter(e => e.compatible.includes(selectedDevice.mode || 'normal'))
    : EXPLOITS;

  return (
    <div className="space-y-4">
      <div>
        <label className="block text-sm font-medium text-[#00FF41] mb-2">
          Select Exploit
        </label>
        <div className="relative">
          <button
            onClick={() => setIsOpen(!isOpen)}
            className={cn(
              "w-full p-3 rounded-lg border text-left flex items-center justify-between transition-all",
              "bg-[#0a0a0a] border-[#FFB000]/30 text-[#00FF41]",
              "hover:border-[#00FF41]/50"
            )}
          >
            <span>{selectedExploit ? EXPLOITS.find(e => e.id === selectedExploit)?.name : 'Select exploit...'}</span>
            <ChevronDown className={cn("w-4 h-4 transition-transform", isOpen && "rotate-180")} />
          </button>

          {isOpen && (
            <div className="absolute z-10 w-full mt-1 rounded-lg border border-[#FFB000]/30 bg-[#0a0a0a] shadow-lg">
              {compatibleExploits.map((exploit) => (
                <button
                  key={exploit.id}
                  onClick={() => handleSelect(exploit.id)}
                  className={cn(
                    "w-full p-3 text-left hover:bg-[#00FF41]/10 transition-colors",
                    "border-b border-[#FFB000]/10 last:border-0",
                    selectedExploit === exploit.id && "bg-[#00FF41]/20"
                  )}
                >
                  <div className="flex items-center gap-2">
                    <Zap className="w-4 h-4 text-[#FFB000]" />
                    <div>
                      <div className="text-[#00FF41] font-medium">{exploit.name}</div>
                      <div className="text-xs text-[#FFB000]/70">{exploit.description}</div>
                    </div>
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>
      </div>

      {selectedExploit && selectedDevice && (
        <button
          onClick={() => onSelectExploit(selectedExploit)}
          className="w-full p-3 rounded-lg border border-[#FF0000]/30 bg-[#FF0000]/10 text-[#FF0000] hover:bg-[#FF0000]/20 transition-colors flex items-center justify-center gap-2"
        >
          <Zap className="w-4 h-4" />
          Execute {EXPLOITS.find(e => e.id === selectedExploit)?.name}
        </button>
      )}
    </div>
  );
}
